name: Deploy to Github Pages

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      #   - uses: actions/checkout@v2
      - uses: actions/checkout@v3
        with:
          submodules: true # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "latest"
          # extended: true

      - name: Clean
        run: hugo mod clean --all

      - name: Build
        run: hugo --minify --gc

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public

    #   - name: Cache Hugo resources
    #     uses: actions/cache@v2
    #     env:
    #       cache-name: cache-hugo-resources
    #     with:
    #       path: resources
    #       key: ${{ env.cache-name }}

    #   - uses: actions/setup-go@v2
    #     with:
    #       go-version: "^1.17.0"
    #   - run: go version

    #   - name: Cache Go Modules
    #     uses: actions/cache@v2
    #     with:
    #       path: |
    #         ~/.cache/go-build
    #         ~/go/pkg/mod
    #       key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
    #       restore-keys: |
    #         ${{ runner.os }}-go-

    #   - name: Setup Hugo
    #     uses: peaceiris/actions-hugo@v2
    #     with:
    #       hugo-version: "latest"
    #       extended: true

    #   - name: Build
    #     run: hugo --minify --gc

    #   - name: Deploy ðŸš€
    #     uses: JamesIves/github-pages-deploy-action@4.1.4
    #     with:
    #       branch: gh-pages
    #       folder: public
    #       clean: true
    #       single-commit: true
